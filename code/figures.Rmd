---
title: "Figures for Lobster-Urchin Functional Resposne"
output: html_document
---

```{r setup, include=T, echo=F}
knitr::opts_chunk$set(echo = TRUE)
```

```{r figure1}

###############################################################################
## Basic plot of number consumed by predator and prey size at max density
##############################################################################

p1 <- df %>%
  filter(density > 24) %>%
ggplot(aes(x = class, y = num_consumed))+
  geom_boxplot(outlier.shape = 4, fill = NA)+
  geom_jitter(aes(color = class), width = 0.3, show.legend = F)+
  scale_color_manual(values = c('#1b9e77','#d95f02','#7570b3','#e7298a'))+
  labs(y = "Number of prey eaten", x = "Predator size category")+
  theme_pubclean()


p2 <- df %>%
  filter(density > 24) %>%
  ggplot(aes(x = treatment, y = num_consumed))+
  geom_boxplot(outlier.shape = 4, fill = NA)+
  geom_jitter(aes(color = treatment), width = 0.3, show.legend = F)+
  scale_color_manual(values = c('#d95f02','#7570b3','#e7298a'))+
  labs(y = "Number of prey eaten", x = "Prey size category")+
  scale_x_discrete(labels = c('large', 'medium', 'small'))+
  theme_pubclean()

fig1 <- cowplot::plot_grid(p1, p2 + labs(y = NULL))


# png("figures/fig1_190312.png", width = 623*1.2, height = 369*1.2)
# fig1
# dev.off()
```

```{r plotjags}

##########################################################
## Plot Jags output
##########################################################

# Write function to plot fits
plot.jags <- function(model, pred_size, urc_size){
  temp <- df %>% filter(class == pred_size, treatment == urc_size)
  killed <- temp$num_consumed
  initial <- temp$num_offered
  plot(killed ~ jitter(initial),data = temp, xlab="Number of prey",ylab="Number consumed", ylim = c(0,26), main = paste(pred_size, "lobster", "--", urc_size, "urchins"))
  a = MCMCsummary(model,params='a')[1] # the alpha estimate here is often bounding up against zero
  h = MCMCsummary(model,params='h')[1]
  curve(holling2(x,a,h,P=1,T=1),add=TRUE,col=1,lty=1) #true curve
  
}


# Plot 12 panel of fits

lob.size <- c("small", "medium", "large", "jumbo")
urc.size <- c("urc_small", "urc_medium", "urc_large")
treat2 <- data.frame(model = as.character(mods), lob.size = rep(lob.size, times = 3), urc.size = rep(urc.size, each = 4))

d <- par(mfrow = c(3,4))
for(i in 1:nrow(treat2)){
  temp <- treat2$model[i]
  plot.jags(get(substitute(temp)), treat2$lob.size[i], treat2$urc.size[i])
}
par(d)

plot.jags(mod1, small, small)
```

